cmake_minimum_required(VERSION 3.13)

# Include devkitpro toolchain
if(NOT DEFINED CMAKE_TOOLCHAIN_FILE)
    if(DEFINED ENV{DEVKITPRO})
        set(CMAKE_TOOLCHAIN_FILE "$ENV{DEVKITPRO}/cmake/Switch.cmake" CACHE PATH "")
        include("$ENV{DEVKITPRO}/cmake/Switch.cmake")
    endif()
endif()

# Project name
project(openjkdf2_switch_minimal)

# Include directories
include_directories($ENV{DEVKITPRO}/libnx/include)
include_directories($ENV{DEVKITPRO}/portlibs/switch/include)

# Find required libraries
find_package(PkgConfig REQUIRED)
pkg_search_module(SDL2 REQUIRED sdl2)
pkg_search_module(SDL2_TTF REQUIRED SDL2_ttf)

# Add executable
add_executable(${PROJECT_NAME} src/main_switch_minimal.c)

# Link libraries
target_link_libraries(${PROJECT_NAME} 
    ${SDL2_LIBRARIES}
    ${SDL2_TTF_LIBRARIES}
    nx
)

# Compiler flags
target_compile_options(${PROJECT_NAME} PRIVATE ${SDL2_CFLAGS_OTHER})

# Create NRO file for Switch
nx_generate_nacp(${PROJECT_NAME}.nacp
    NAME "OpenJKDF2 Switch Test"
    AUTHOR "OpenJKDF2 Team"
    VERSION "1.0.0"
)

nx_create_nro(${PROJECT_NAME}
    NACP ${PROJECT_NAME}.nacp
    ICON ${CMAKE_CURRENT_SOURCE_DIR}/icon.jpg
)
